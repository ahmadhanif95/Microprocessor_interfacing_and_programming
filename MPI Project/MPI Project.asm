ORG 0
	JMP MAIN
	;==============================================================	R2=THOUSANDTHS R3=HUNDREDTHS R4= TENS R5=UNITS
	ORG 0BH
	MOV TL0,#07H										   ;
	MOV TH0,#4CH										   
	DJNZ R0,BACK ;1 SEC
	MOV R0,#20
	DJNZ R1,BACK ; 60 SECONDS
	MOV R1,#60
	INC R5  ;INCREMENT MIN
	CJNE R5,#10,BACK
	MOV R5,#0
	INC R4
	CJNE R4,#6,BACK
	MOV R4,#0
	INC R3
	CJNE R2,#2,BACK
	JMP TMS
	HRST: 
	CJNE R3,#10,BACK
	MOV R3,#0
	INC R2
	TMS: 
	CJNE R2,#2,BACK
	CJNE R3,#4,BACK
	MOV R3,#0
	MOV R2,#0
	BACK:
		RETI
;==============================================================		
	MAIN: 
	MOV P0,#0
	MOV P1,#00001111B
	MOV P2,#0
	MOV P3,#0
	MOV R0,#20
	MOV R1,#60
	MOV R2,#0
	MOV R3,#0
	MOV R4,#0
	MOV R5,#0
	MOV 50H,#0
	MOV 51H,#0
	MOV 52H,#0
	MOV 53H,#0
	MOV IE,#10000010B					   ;IE.7(ENABLE INTERRUPT) AND IE.1 (TIMER0) INTERRUPT
	MOV TMOD,#0001B
	MOV TL0,#07H
	MOV TH0,#4CH
	CLR TF0
	SETB TR0

	;============================================================== TIME IN R2,R3,R4 AND R5
	DISP:
	
	CALL CH_INPUT
	CALL CLRSEG
	CALL CH_INPUT
	MOV A,R2
	CALL DISPTIME 
	CALL CH_INPUT 
	CALL CLRSEG 
	CALL CH_INPUT
	MOV A,R3
	CALL DISPTIME
	CALL CH_INPUT
	CALL CLRSEG
	MOV A,R4
	CALL DISPTIME
	CALL CH_INPUT
	CALL CLRSEG
	CALL CH_INPUT
	MOV A,R5
	CALL DISPTIME
	CALL CLRSEG
	
	MOV A,#01H;;LCD CLEAR
    CALL CMDWRT
    CALL DELAY
	CALL CH_INPUT
	
	JMP DISP
	
	CH_INPUT:
	MOV P1,#01111111B
	MOV A,P1
	ANL A,#0111B
	CJNE A,#0111B,CH
	RET
	
	
	CH:
	RRC A
	JNC SETTIME
	RRC A
	JNC DISP
	
	ERROR:
	CALL DISP_ERR
	SETTIME:
	MOV A,#01H

	RELEASE_:
	MOV A,P1
	ANL A,#7H
	CJNE A,#7H,RELEASE_
	CALL DISP_ENTER
	CALL KEYCHK
	MOV R5,35H						   ;======STORING VALUES FROM KEYPAD
	CALL KEYCHK
	MOV R4,35H
	CALL KEYCHK
	MOV R3,35H
	CALL KEYCHK
	MOV R2,35H
	STY:
	MOV P1,#7FH
	MOV A,P1
	ANL A,#7H
	SETB CY
	RRC A
	JC STY
ERCH:
	CLR CY
	CJNE R5,#10,CK
	JMP ERROR
	CK:
	JNC ERROR
	CLR CY
	CJNE R4,#6,CK1
	JMP ERROR
	CK1:
	JNC ERROR
	CJNE R2,#2,CK2
	CLR CY
	CJNE R3,#4,CK3
	JMP ERROR
	CK3:
	JNC ERROR
	JMP NO_ERROR
	CK2:
	CLR CY
	CJNE R3,#10,CK4
	JMP ERROR
	CK4:
	JNC ERROR
	CLR CY
	CJNE R2,#2,CK5
	JMP ERROR
	CK5:
	JNC ERROR
	NO_ERROR:
	 MOV A,P1
	ANL A,#0111B
	CJNE A,#0111B,NO_ERROR
	JMP DISP
	 
	


DISPTIME:
	
	CJNE A,#0,N1
	CALL ZERO
	N1: 
	CJNE A,#1,N2
	CALL ONE
	JMP NA
	N2: 
	CJNE A,#2,N3
	CALL TWO
	JMP NA
	N3: 
	CJNE A,#3,N4
	CALL THREE
	JMP NA
	N4: 
	CJNE A,#4,N5
	CALL FOUR
	JMP NA
	N5: 
	CJNE A,#5,N6
	CALL FIVE
	JMP NA
	N6: 
	CJNE A,#6,N7
	CALL SIX
	JMP NA
	N7: 
	CJNE A,#7,N8
	CALL SEVEN
	JMP NA
	N8: 
	CJNE A,#8,N9
	CALL EIGHT
	JMP NA
	N9: 
	CJNE A,#9,NA
	CALL NINE
	NA:
	RET
	CLRSEG:	
	MOV 40H,#2
LOOP15:MOV 41H,#255
LOOP16:MOV 42H,#255
LOOP17:
MOV P3,#00000000B
MOV P2,#00000000B
DJNZ 42H,LOOP17
DJNZ 41H,LOOP16
DJNZ 40H,LOOP15
RET  
ZERO:
MOV 40H,#100
LP:
MOV P3,#10111110B
MOV P2,#01110000B
CALL DELAY
MOV P3,#11000001B
MOV P2,#10001000B
CALL DELAY
DJNZ 40H,LP
RET	
ONE:	
MOV 40H,#3
LOOP1:MOV 41H,#255
LOOP2:MOV 42H,#255
LOOP3:
MOV P3,#10000000B
MOV P2,#10000000B
DJNZ 42H,LOOP3
DJNZ 41H,LOOP2
DJNZ 40H,LOOP1
RET  
TWO:
MOV 40H,#50
LOOP4:
MOV P3,#10110110B
MOV P2,#01110000B
CALL DELAY
MOV P3,#11111001B
MOV P2,#10000000B
CALL DELAY
MOV P3,#10001111B
MOV P2,#00001000B
CALL DELAY
DJNZ 40H,LOOP4
RET	
THREE:
MOV 40H,#100
LOOP5:
MOV P3,#10110110B
MOV P2,#01111000B
CALL DELAY
MOV P3,#11001001B
MOV P2,#10000000B
CALL DELAY
DJNZ 40H,LOOP5
RET	
FOUR:
MOV 40H,#50
LOOP6:	
MOV P3,#11111000B
MOV P2,#00001000B
CALL DELAY
MOV P3,#11110111B
MOV P2,#01110000B
CALL DELAY
MOV P3,#11111000B
MOV P2,#10000000B
CALL DELAY
MOV P3,#10001111B
MOV P2,#10000000B
CALL DELAY
DJNZ 40H,LOOP6
RET	
FIVE:
MOV 40H,#50
LOOP7:
MOV P3,#10110110B
MOV P2,#01110000B
CALL DELAY
MOV P3,#11111001B
MOV P2,#00001000B
CALL DELAY
MOV P3,#10001111B
MOV P2,#10000000B
CALL DELAY
DJNZ 40H,LOOP7
RET	
SIX:
MOV 40H,#50
LOOP8:
MOV P3,#10110110B
MOV P2,#01110000B
CALL DELAY
MOV P3,#11111001B
MOV P2,#00001000B
CALL DELAY
MOV P3,#11001111B
MOV P2,#10001000B
CALL DELAY
DJNZ 40H,LOOP8
RET	
SEVEN:
MOV 40H,#100
LOOP9:
MOV P3,#11111110B
MOV P2,#01111000B
CALL DELAY
MOV P3,#10000001B
MOV P2,#10000000B
CALL DELAY
DJNZ 40H,LOOP9
RET	
EIGHT:
MOV 40H,#100
LOOP10:
MOV P3,#10110110B
MOV P2,#01110000B
CALL DELAY
MOV P3,#11001001B
MOV P2,#10001000B
CALL DELAY
DJNZ 40H,LOOP10
RET	
NINE:
MOV 40H,#50
LOOP11:
MOV P3,#10110110B
MOV P2,#01110000B
CALL DELAY
MOV P3,#11111001B
MOV P2,#10001000B
CALL DELAY
MOV P3,#11001111B
MOV P2,#10000000B
CALL DELAY
DJNZ 40H,LOOP11
RET

;=====================================================================   KEYPAD
	
KEYCHK:
	MOV P1,#0FH
	START:
	MOV 30H,#7H
	AGAIN:
	MOV 31H,#0EFH
	MOV 32H,#0
	MOV 33H,#0
	NEXT_ROW:
	MOV P1,31H 
	MOV A,P1
	ANL A,30H
	CJNE A,30H,KEY_PRESSED
	MOV A,31H
	RL A
	MOV 31H,A
	MOV A,32H
	INC A 
	MOV 32H,A
	CJNE A,#4,NEXT_ROW
	JMP AGAIN
	KEY_PRESSED:
	CALL DELAY
	AGAIN1:
	RRC A
	JNC FINDKEY
	MOV 37H,A
	MOV A,33H
	INC A
	MOV 33H,A
	MOV A,37H
	JMP AGAIN1
	FINDKEY:
	MOV A,#3
	MOV B,32H
	MUL AB
	ADD A,33H
	MOV DPTR,#KEY
	MOVC A,@A+DPTR
	MOV 35H,A
	RELEASE_KEY:
	MOV A,P1
	ANL A,30H
	CJNE A,30H,RELEASE_KEY
	CALL DELAY
	
RET



;===================================== DISPLAY ENTER TIME


DISP_ENTER: 
MOV A,#38H
CALL CMDWRT
CALL DELAY
MOV A,#0EH
CALL CMDWRT
CALL DELAY
MOV A,#01H
CALL CMDWRT
CALL DELAY
MOV A,#06H
CALL CMDWRT
CALL DELAY
MOV A,#80H
CALL CMDWRT
CALL DELAY
MOV A,#'E'
CALL DATWRT
CALL DELAY
MOV A,#'n'
CALL DATWRT
CALL DELAY
MOV A,#'t'
CALL DATWRT
CALL DELAY
MOV A,#'e'
CALL DATWRT
CALL DELAY
MOV A,#'r'
CALL DATWRT
CALL DELAY
MOV A,#' '
CALL DATWRT
CALL DELAY
MOV A,#'t'
CALL DATWRT
CALL DELAY
MOV A,#'h'
CALL DATWRT
CALL DELAY
MOV A,#'e'
CALL DATWRT
CALL DELAY
MOV A,#' '
CALL DATWRT
CALL DELAY
MOV A,#'t'
CALL DATWRT
CALL DELAY
MOV A,#'i'
CALL DATWRT
CALL DELAY
MOV A,#'m'
CALL DATWRT
CALL DELAY
MOV A,#'e'
CALL DATWRT
CALL DELAY
MOV A,#'!'
CALL DATWRT
CALL DELAY
MOV A,#' '
CALL DATWRT
CALL DELAY
MOV A,#'('
CALL DATWRT
CALL DELAY
MOV A,#'M'
CALL DATWRT
CALL DELAY
MOV A,#'I'
CALL DATWRT
CALL DELAY
MOV A,#'N'
CALL DATWRT
CALL DELAY
MOV A,#' '
CALL DATWRT
CALL DELAY
MOV A,#'F'
CALL DATWRT
CALL DELAY
MOV A,#'I'
CALL DATWRT
CALL DELAY
MOV A,#'R'
CALL DATWRT
CALL DELAY
MOV A,#'S'
CALL DATWRT
CALL DELAY
MOV A,#'T'
CALL DATWRT
CALL DELAY
MOV A,#')'
CALL DATWRT
CALL DELAY
RET

;====================================================== LCD ERROR DISP

DISP_ERR: 
MOV A,#38H
CALL CMDWRT
CALL DELAY
MOV A,#0EH
CALL CMDWRT
CALL DELAY
MOV A,#01H
CALL CMDWRT
CALL DELAY
MOV A,#06H
CALL CMDWRT
CALL DELAY
MOV A,#80H
CALL CMDWRT
CALL DELAY
MOV A,#'E'
CALL DATWRT
CALL DELAY
MOV A,#'r'
CALL DATWRT
CALL DELAY
MOV A,#'r'
CALL DATWRT
CALL DELAY
MOV A,#'o'
CALL DATWRT
CALL DELAY
MOV A,#'r'
CALL DATWRT
MOV A,#'!'
CALL DATWRT
CALL DELAY
CALL DELAY
CALL DELAY
CALL DELAY
CALL DELAY
CALL DELAY

RET

DATWRT:
MOV P0,A
SETB P2.0
SETB P2.1
CLR P2.1
RET

CMDWRT:
MOV P0,A
CLR P2.0
SETB P2.1
CLR P2.1
RET
DELAY:
MOV R6,#10
LOOOP:
MOV R7,#255
DJNZ R7,$
DJNZ R6, LOOOP
RET
KEY: DB 1,2,3,4,5,6,7,8,9,'*',0,'#'
		
		
END